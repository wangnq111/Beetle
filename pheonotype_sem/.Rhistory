#查看模型系数
inspect(fit_model,what="std")
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
df[,beetle_PC2]
df[,"beetle_PC2"]
df[,"beetle_PC2"] %>% as.numeric()
df=scale(sem_data[,7:57],center=TRUE,scale=TRUE)
df[,"beetle_PC2"]=-(df[,"beetle_PC2"] %>% as.numeric())
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria
Kegg_Organoheterocyclic.compounds~leaf_PC2+leaf_p__Cyanobacteriota
Kegg_Organic.nitrogen.compounds~leaf_PC2+leaf_p__Cyanobacteriota
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria
Kegg_Organoheterocyclic.compounds~leaf_PC2
Kegg_Organic.nitrogen.compounds~leaf_PC2
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH#+ beetle_p__Patescibacteria
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
fitmeasures(fit_model,c("chisq", "df", "gfi", "rmsea", "srmr","pvalue"))
##参数标准，检验模型是否合理,一般标准为
#df<5;gfi>0.8;rmsea<0.05;srmr<0.08
#具体标准可自行参考文献
modindices(fit_model,sort.=TRUE)
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria+leaf_PC2+leaf_p__Cyanobacteriota
Kegg_Organic.nitrogen.compounds~leaf_PC2+leaf_p__Cyanobacteriota
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria+leaf_PC2
Kegg_Organic.nitrogen.compounds~leaf_PC2
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
fitmeasures(fit_model,c("chisq", "df", "gfi", "rmsea", "srmr","pvalue"))
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria
Kegg_Organic.nitrogen.compounds~leaf_PC2
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
fitmeasures(fit_model,c("chisq", "df", "gfi", "rmsea", "srmr","pvalue"))
25.044/265
25.044/26
##参数标准，检验模型是否合理,一般标准为
#df<5;gfi>0.8;rmsea<0.05;srmr<0.08
#具体标准可自行参考文献
modindices(fit_model,sort.=TRUE)
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria
Kegg_Organic.nitrogen.compounds~leaf_PC2
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
Kegg_Organoheterocyclic.compounds ~~   Kegg_Organic.nitrogen.compounds
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
fitmeasures(fit_model,c("chisq", "df", "gfi", "rmsea", "srmr","pvalue"))
##参数标准，检验模型是否合理,一般标准为
#df<5;gfi>0.8;rmsea<0.05;srmr<0.08
#具体标准可自行参考文献
modindices(fit_model,sort.=TRUE)
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds+ beetle_PC2
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds  +beetle_PC2
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria
Kegg_Organic.nitrogen.compounds~leaf_PC2
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
Kegg_Organoheterocyclic.compounds ~~   Kegg_Organic.nitrogen.compounds
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
fitmeasures(fit_model,c("chisq", "df", "gfi", "rmsea", "srmr","pvalue"))
model <- '
# 1.direct effect
Weight ~  beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds +
Kegg_Organic.nitrogen.compounds
Length ~ beetle_p__Patescibacteria + Kegg_Organoheterocyclic.compounds  +beetle_PC2
# leaf -> beetle taxa
beetle_p__Patescibacteria~leaf_PC2
beetle_PC2~leaf_PC2
beetle_p__Spirochaetota~leaf_p__Cyanobacteriota
# leaf direct effect on CAZy
# beetle taxa -> CAZy
#CAZy_PC1~beetle_p__Patescibacteria+beetle_p__Spirochaetota
CAZy_SLH~beetle_PC2+beetle_p__Spirochaetota
# CAZy -> Kegg
Kegg_Organoheterocyclic.compounds~CAZy_SLH+ beetle_p__Patescibacteria
Kegg_Organic.nitrogen.compounds~leaf_PC2
# 残差相关
Length ~~ Weight
beetle_p__Patescibacteria ~~beetle_p__Spirochaetota
beetle_p__Patescibacteria ~~beetle_PC2
beetle_p__Spirochaetota ~~beetle_PC2
leaf_p__Cyanobacteriota~~leaf_PC2
Kegg_Organoheterocyclic.compounds ~~   Kegg_Organic.nitrogen.compounds
'
fit_model<-sem(model,data=df)
#resid(fit_model, type = "cor")
#查看模型结果以及路径显著性
summary(fit_model,fit.measures=TRUE,standardized=TRUE,rsq=T)
fitmeasures(fit_model,c("chisq", "df", "gfi", "rmsea", "srmr","pvalue"))
library(linkET)
library(ggplot2)
qcorrplot(correlate(select_factor_frame,method="spearman"),type = "lower", diag = FALSE ) +
geom_square() +
geom_couple(aes(colour = effect, size = rd),
data = cor_result_clean,
curvature = nice_curvature())+
geom_mark(sep = '\n',size = 2, sig_level = c(0.05, 0.01, 0.001),
sig_thres = 0.05, color = 'white') + ##添加显著性和相关性值
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(11, "RdBu")) +
scale_size_manual(values = c(0.5, 1, 2)) +
scale_colour_manual(values = c("#B2182B","#2166AC")) +
guides(size = guide_legend(title = "Spearman's rho",
override.aes = list(colour = "grey35"),
order = 2),
colour = guide_legend(title = "Effect",
override.aes = list(size = 3),
order = 1),
fill = guide_colorbar(title = "Spearman's rho", order = 3))
qcorrplot(correlate(select_factor_frame,method="spearman"),type = "lower", diag = FALSE ) +
geom_square()
qcorrplot(correlate(select_factor_frame,method="spearman"),type = "lower", diag = FALSE ) +
geom_square() +
geom_couple(aes(colour = effect, size = rd),
data = cor_result_clean,
curvature = nice_curvature())+
geom_mark(sep = '\n',size = 3, sig_level = c(0.05, 0.01, 0.001),
sig_thres = 0.05, color = 'white') + ##添加显著性和相关性值
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(11, "RdBu")) +
scale_size_manual(values = c(0.5, 1, 2)) +
scale_colour_manual(values = c("#B2182B","#2166AC")) +
guides(size = guide_legend(title = "Spearman's rho",
override.aes = list(colour = "grey35"),
order = 2),
colour = guide_legend(title = "Effect",
override.aes = list(size = 3),
order = 1),
fill = guide_colorbar(title = "Spearman's rho", order = 3))
ggsave("allcor.pdf",width = 12,height = 8)
qcorrplot(correlate(select_factor_frame,method="spearman"),type = "lower", diag = FALSE ) +
geom_square() +
geom_couple(aes(colour = effect, size = rd),
data = cor_result_clean,
curvature = nice_curvature())+
geom_mark(sep = '\n',size = 3, sig_level = c(0.05, 0.01, 0.001),
sig_thres = 0.05, color = 'orange') + ##添加显著性和相关性值
scale_fill_gradientn(colours = RColorBrewer::brewer.pal(11, "RdBu")) +
scale_size_manual(values = c(0.5, 1, 2)) +
scale_colour_manual(values = c("#B2182B","#2166AC")) +
guides(size = guide_legend(title = "Spearman's rho",
override.aes = list(colour = "grey35"),
order = 2),
colour = guide_legend(title = "Effect",
override.aes = list(size = 3),
order = 1),
fill = guide_colorbar(title = "Spearman's rho", order = 3))
temp=correlate(select_factor_frame,method="spearman"),type = "lower", diag = FALSE )
temp=correlate(select_factor_frame,method="spearman")
View(temp)
write.table(temp$r,"fig7ar.txt",row.names = T,sep="\t")
write.table(temp$p,"fig7ap.txt",row.names = T,sep="\t")
effect
View(cor_result_clean)
write.table(cor_result_clean,"fig7cor.txt",row.names = T,sep="\t")
version
citation("LorMe")
?correlate
library(patchwork)
pheonotype=read.table("./input/pheono.txt",header = T,sep="\t")
source("./autoplot.R")
metafile=read.table("./input/metafile.txt",header = T,sep="\t")
plant_col=color_scheme("Plan7",names=unique(metafile$Plant))
plant_order=c("HS","YJ","XS","SJ","LS","PG","YS","SHT")
sex_col=c("F"="#FE5D5D",FM="#6376A0")
pheonotype$Plant=factor(pheonotype$Plant,levels = plant_order)
leave_genus=leave_obj_plan$Genus_percent
load("./beetle_community.rda")
load("./beetle_metabolome.rda")
load("./leave_obj_plan.rda")
load("./tax_obj_plan1.rda.rda")
load("./beetle_metabolome.rda")
load("./leave_obj_plan.rda")
library(LorMe)
load("./tax_obj_plan1.rda")
load("./beetle_metabolome.rda")
load("./leave_obj_plan.rda")
##leave
leave_com=community_plot(taxobj = leave_obj_plan,taxlevel = "Phylum",n = 10)
leave_com_top_phylum=leave_com$Top10Phylum
library(LorMe)
load("./tax_obj_plan1.rda")
load("./beetle_metabolome.rda")
load("./leave_obj_plan.rda")
##leave
leave_com=community_plot(taxobj = leave_obj_plan,taxlevel = "Phylum",n = 10)
leave_com_top_phylum=leave_com$Top10Phylum
sem_data=data.frame(metafile,t(leave_com_top_phylum[,-1]))
colnames(sem_data)[9:19]=paste0("leaf_",leave_com_top_phylum$Phylum)
leave_str=structure_plot(taxobj = leave_obj_plan,taxlevel = "Genus")
sem_data=data.frame(sem_data,leave_str$PCoA_coordinates[,1:2])
colnames(sem_data)[20:21]=c("leaf_PC1","leaf_PC2")
##beetle community
beetle_com=community_plot(taxobj =tax_obj_plan2 ,taxlevel = "Phylum",n = 10)
beetle_com_top_phylum=beetle_com$Top10Phylum
##beetle community
beetle_com=community_plot(taxobj =tax_obj_plan1 ,taxlevel = "Phylum",n = 10)
beetle_com_top_phylum=beetle_com$Top10Phylum
sem_data=data.frame(sem_data,t(beetle_com_top_phylum[,-1]))
colnames(sem_data)[22:32]=paste0("beetle_",beetle_com_top_phylum$Phylum)
beetle_str=structure_plot(taxobj = tax_obj_plan1,taxlevel = "Genus")
sem_data=data.frame(sem_data,beetle_str$PCoA_coordinates[,1:2])
colnames(sem_data)[33:34]=c("beetle_PC1","beetle_PC2")
##beetle cazy
sem_data=data.frame(sem_data,t(cate2_mean[,-1]))
colnames(sem_data)[35:43]=paste0("CAZy_",cate2_mean$Type)
leave_genus=leave_obj_plan$Genus_percent
leave_genus_taxonomy=leave_obj_plan$Genus_taxonomy
leave_genus_taxonomy$Phylum[!leave_genus_taxonomy$Phylum %in% leave_com_top_phylum$Phylum[1:10] ] ="Other"
beetle_genus=tax_obj_plan2$Genus_percent
beetle_genus_taxonomy=tax_obj_plan2$Genus_taxonomy
beetle_genus_taxonomy$Phylum[!beetle_com_top_phylum$Phylum %in% beetle_com_top_phylum$Phylum[1:10] ] ="Other"
leave_genus=leave_obj_plan$Genus_percent
leave_genus_taxonomy=leave_obj_plan$Genus_taxonomy
leave_genus_taxonomy$Phylum[!leave_genus_taxonomy$Phylum %in% leave_com_top_phylum$Phylum[1:10] ] ="Other"
beetle_genus=tax_obj_plan1$Genus_percent
beetle_genus_taxonomy=tax_obj_plan1$Genus_taxonomy
beetle_genus_taxonomy$Phylum[!beetle_com_top_phylum$Phylum %in% beetle_com_top_phylum$Phylum[1:10] ] ="Other"
CAZY=read.table("./input//CAZY.txt",header = T,sep="\t")
CAZY_pct=sweep(CAZY[,-c(1:2)],colSums(CAZY[,-c(1:2)]),"/",MARGIN=2)
metabolite=read.csv("./input/metabolism.csv",header = T,encoding = "UTF-8",as.is = TRUE)
metabolite_pct=sweep(metabolite[,35:82],colSums(metabolite[,35:82]),"/",MARGIN=2)
kegg_anno=data.frame(KeggID=paste0("kegg",1:nrow(metabolite)),metabolite[,1:34])
combine_frame=data.frame(t(leave_genus[,-1]),t(beetle_genus[,-1]),t(CAZY_pct),t(metabolite_pct))
colnames(combine_frame)=c(paste0("leaf_",leave_genus_taxonomy$GenusID),
paste0("beetle_",beetle_genus_taxonomy$GenusID),
paste0("cazy_",CAZY$Subtype),
paste0("kegg_",kegg_anno$KeggID))
combine_anno=data.frame(ID=colnames(combine_frame),
cate=c(paste0("leaf_",leave_genus_taxonomy$Phylum),
paste0("beetle_",beetle_genus_taxonomy$Phylum),
paste0("cazy_",CAZY$Type),
paste0("kegg_",kegg_anno$ClassI)))
cate_name=c(paste0("leaf_",leave_com_top_phylum$Phylum[1:10]),
paste0("beetle_",beetle_com_top_phylum$Phylum[1:10]),
paste0("cazy_",unique(CAZY$Type)),
paste0("kegg_",unique(kegg_anno$ClassI)))
cate_name=cate_name[!cate_name %in% c("kegg__")]
phylumlist=list()
for(i in cate_name){
num=grep(i,combine_anno$cate)
phylumlist=c(phylumlist,list(num))
names(phylumlist)[[length(phylumlist)]]=i
}
library(linkET)
###
select_factor_frame=sem_data[,select_factor[-c(1:2,9,12,14,15,18)]]
cor_obj=correlate(sem_data[,7:8],select_factor_frame,method="spearman")
